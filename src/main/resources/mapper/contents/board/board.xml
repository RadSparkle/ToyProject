<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.toyproject.api.contents.board.mapper.BoardMapper">
   <select id="getBoardList" resultType="com.toyproject.api.contents.board.dto.BoardDto$boardList" parameterType="com.toyproject.api.contents.board.dto.BoardDto$boardList">
       SELECT a.bid AS bid
            , a.pid AS pid
            , a.title AS title
            , a.views AS views
            , a.cmt_count AS cmtCount
            , a.is_use AS isUse
            , a.reg_dt AS regDt
            , b.board_name AS boardName
            , c.contents AS contents
       FROM toy_cont.board a
       LEFT OUTER JOIN (SELECT bid,b_type,board_name from toy_cont.board_group WHERE bid = #{bid}) b ON a.bid = b.bid
       LEFT OUTER JOIN (SELECT bid, contents, pid FROM toy_cont.board_info WHERE bid = #{bid}) c ON a.pid = c.pid
       WHERE a.bid = #{bid}
         AND is_use = 1
       ORDER BY a.pid ASC
   </select>

    <select id="getBoardCount" resultType="HashMap" parameterType="com.toyproject.api.contents.board.dto.BoardDto$boardList">
        SELECT COUNT(*) AS boardCount
        FROM toy_cont.board
        WHERE bid = #{bid}
          AND is_use = 1
    </select>

    <insert id="insertBoardInfo" parameterType="com.toyproject.api.contents.board.dto.BoardDto$boardInfo">
        <selectKey keyProperty="pid" resultType="Integer" order="BEFORE">
            SELECT IFNULL(MAX(pid)+1, 1) AS pid
            FROM toy_cont.board_info WHERE bid = #{bid}
        </selectKey>
        INSERT INTO toy_cont.board_info (bid, uid, nickname, b_link, img_link, is_notice, is_use, pid, title, contents)
        VALUES (#{bid}, #{uid}, #{nickname}, #{bLink}, #{imgLink}, #{isNotice}, #{isUse}, #{pid}, #{title}, #{contents})
    </insert>

    <insert id="insertBoard" parameterType="com.toyproject.api.contents.board.dto.BoardDto$boardInfo">
            <selectKey keyProperty="pid" resultType="Integer" order="BEFORE">
                SELECT IFNULL(MAX(pid)+1,1) AS pid
                FROM toy_cont.board WHERE bid = #{bid}
            </selectKey>
        INSERT INTO toy_cont.board (bid, title, uid, pid)
        VALUES (#{bid}, #{title}, #{uid}, #{pid})
    </insert>

    <select id="getBoardInfo" parameterType="Integer" resultType="com.toyproject.api.contents.board.dto.BoardDto$boardInfo">
        SELECT pid AS pid
             , bid AS bid
             , uid AS uid
             , title AS title
             , nickname AS nickname
             , b_link AS bLink
             , img_link AS imgLink
             , is_notice AS isNotice
             , is_use AS isUse
             , reg_dt AS regDt
             , mod_dt AS modDt
             , contents AS contents
        FROM toy_cont.board_info
        WHERE pid = #{pid}
          AND bid = #{bid}
          AND is_use = 1
    </select>

    <update id="deleteBoard" parameterType="com.toyproject.api.contents.board.dto.BoardDto$boardInfo">
        UPDATE toy_cont.board
        SET is_use = 0
        WHERE bid = #{bid}
          AND pid = #{pid}
          AND uid = #{uid}
    </update>

    <update id="deleteBoardInfo" parameterType="com.toyproject.api.contents.board.dto.BoardDto$boardInfo">
        UPDATE toy_cont.board_info
        SET is_use = 0
        WHERE bid = #{bid}
          AND pid = #{pid}
          AND uid = #{uid}
    </update>
</mapper>